# Olo.Promotions.ExampleAPI

This is an example API application that shows how to use Olo.Promotions.SDK to do the following:

- Accept incoming Promotions requests using the models in `Olo.Promotions.SDK.Requests`
- Send responses using the models in `Olo.Promotions.SDK.Responses`
- Handle exceptions and return the expected error schema
- Authenticate Promotions requests using the `RequestAuthenticator`

> [!WARNING]
> This application is only provided as an example and **should not be run in production environments**.

## Getting Started

### IDE

Open `Olo.Promotions.ExampleAPI.sln` in the IDE of your choice, then launch it using one of the provided launch profiles.

By default, it will launch the API and open a browser at `{app-url}/swagger` to view the API docs generated by Swagger.

### Command Line

1. Build the API. `dotnet build`
2. Run the API
   1. (HTTP): `dotnet run --project .\Olo.Promotions.ExampleAPI\Olo.Promotions.ExampleAPI.csproj`
   2. (HTTPS):
`dotnet run --launch-profile https --project .\Olo.Promotions.ExampleAPI\Olo.Promotions.ExampleAPI.csproj`

Swagger API docs can be viewed at `{app-url}/swagger`.

## Configuration

Promotions authentication settings can be found in `appsettings.json` and `appsettings.Development.json` under the `Promotions` section.

- `AuthenticationMethod` (string): determines whether to use Key-Based or Basic authentication
  - Accepted values: "KeyBased", "Basic"
- `Secret` (string): the shared secret between Olo and the Promotions provider.
- `SkipAuthentication` (bool): determines whether to disable Promotions request authentication. *For development purposes only.*

## Overview

### Controllers

These handle Promotions requests. They define their own routes as well as their request/response schemas.

There is one Controller per Promotions endpoint.

### Middleware

The custom middleware is used to handle things for every request.

There are three middlewares:

- `PromotionsErrorHandlerMiddleware`
  - Catches any exceptions that happen while handling the Promotions request and returns a 500 Internal Server Error response with the expected Promotions error response schema.
- `PromotionsRequestAuthenticatorMiddleware`
  - Verifies each request by verifying the signature specified in the `X-Promo-Signature` header.
- `PromotionsVersionHeaderMiddleware`
  - Adds the `X-Promo-Version` header to all responses.
